# Type Definitions - AI Travel Planner

This directory contains all TypeScript type definitions for the AI Travel Planner application.

## üìÅ Structure

```
src/types/
‚îú‚îÄ‚îÄ database.types.ts        # Supabase-generated database types (DO NOT EDIT)
‚îú‚îÄ‚îÄ dto.ts                   # Data Transfer Objects (DTOs) for API operations
‚îú‚îÄ‚îÄ travel-profile.ts        # Travel profile and quiz types
‚îú‚îÄ‚îÄ index.ts                 # Centralized exports
‚îî‚îÄ‚îÄ README.md               # This file
```

## üéØ Purpose

### `database.types.ts`
**Auto-generated** by Supabase CLI. Contains the complete database schema as TypeScript types.

**‚ö†Ô∏è DO NOT EDIT THIS FILE MANUALLY**

To regenerate:
```bash
npx supabase gen types typescript --project-id YOUR_PROJECT_ID > src/types/database.types.ts
```

### `dto.ts`
**Data Transfer Objects (DTOs)** - hand-crafted types that:
- Derive from database models
- Represent data structures for API operations
- Provide type safety for Server Actions
- Include validation and transformation logic

### `travel-profile.ts`
Types specific to the travel profile quiz and AI-generated personality profiles.

### `index.ts`
Centralized exports for all types. **Always import from here** for consistency:

```typescript
import type { UserProfileDTO, ItineraryDTO } from '@/types';
```

---

## üìö DTO Categories

### 1. **Common DTOs**

Generic types used across the application:

```typescript
import type { ActionResult, PaginationParams, PaginatedResponse } from '@/types';

// ActionResult - Consistent success/error wrapper
const result: ActionResult<string> = { success: true, data: "Hello" };

// PaginationParams - Pagination parameters
const params: PaginationParams = { limit: 20, offset: 0 };
```

### 2. **Auth DTOs**

Authentication-related types:

```typescript
import type { SignUpDTO, SignInDTO, UserSessionDTO } from '@/types';

const signUpData: SignUpDTO = {
  email: 'user@example.com',
  password: 'password123',
  confirmPassword: 'password123',
  name: 'John Doe'
};
```

### 3. **Profile DTOs**

User profile management:

```typescript
import type { 
  UserProfileDTO, 
  UpdateProfileNameDTO, 
  CompleteTravelProfileDTO 
} from '@/types';

// Display user profile
const profile: UserProfileDTO = {
  id: 'uuid',
  email: 'user@example.com',
  full_name: 'John Doe',
  displayName: 'John',
  // ... other fields
};
```

### 4. **Itinerary DTOs**

Travel itinerary operations:

```typescript
import type { 
  ItineraryDTO, 
  CreateItineraryDTO, 
  ItineraryFilterDTO 
} from '@/types';

// Create itinerary
const createData: CreateItineraryDTO = {
  destination: 'Paris',
  days: 5,
  travelers: 2,
  model: 'gemini-flash'
};

// Filter itineraries
const filters: ItineraryFilterDTO = {
  tags: ['europe', 'city-break'],
  destination: 'Paris',
  limit: 20,
  offset: 0
};
```

### 5. **Subscription DTOs**

User subscription and usage tracking:

```typescript
import type { 
  UserSubscriptionDTO, 
  CanGeneratePlanDTO, 
  UsageStatsDTO 
} from '@/types';

// Check if user can generate
const canGenerate: CanGeneratePlanDTO = {
  allowed: true,
  cost: 0.15,
  needsUpgrade: false
};
```

### 6. **Bucket List DTOs**

Saved itineraries:

```typescript
import type { 
  BucketListItemDTO, 
  AddToBucketListDTO 
} from '@/types';

const addData: AddToBucketListDTO = {
  itineraryId: 'uuid'
};
```

### 7. **AI Generation DTOs**

AI itinerary generation:

```typescript
import type { 
  GenerateItineraryDTO, 
  AIGenerationResultDTO,
  ModelKey 
} from '@/types';

const generateData: GenerateItineraryDTO = {
  destination: 'Tokyo',
  days: 7,
  travelers: 2,
  model: 'claude-haiku',
  operation: 'create'
};
```

### 8. **Admin DTOs**

Admin operations:

```typescript
import type { 
  AdminUserDTO, 
  AdminStatsDTO, 
  UpdateUserRoleDTO 
} from '@/types';
```

### 9. **Payment DTOs**

Stripe payment integration:

```typescript
import type { 
  StripeTransactionDTO, 
  CreatePaymentSessionDTO 
} from '@/types';
```

---

## üõ†Ô∏è Usage Patterns

### Pattern 1: Server Actions with ActionResult

```typescript
import type { ActionResult, ItineraryDTO } from '@/types';

export async function getItinerary(id: string): Promise<ActionResult<ItineraryDTO>> {
  try {
    // ... fetch itinerary
    return { success: true, data: itinerary };
  } catch (error) {
    return { success: false, error: 'Failed to fetch itinerary' };
  }
}
```

### Pattern 2: Client-Side with Type Guards

```typescript
import type { ActionResult, ItineraryDTO } from '@/types';
import { isActionSuccess } from '@/types';

const result: ActionResult<ItineraryDTO> = await getItinerary(id);

if (isActionSuccess(result)) {
  console.log(result.data.destination); // TypeScript knows data exists
} else {
  console.error(result.error); // TypeScript knows error exists
}
```

### Pattern 3: Database Inserts with Pick

```typescript
import type { ProfileRow, CreateInput } from '@/types';

// Only fields needed for insert (auto-generated fields omitted)
type CreateProfileInput = CreateInput<ProfileRow>;

const newProfile: CreateProfileInput = {
  id: userId,
  email: 'user@example.com',
  full_name: 'John Doe'
  // No created_at or updated_at needed
};
```

### Pattern 4: Form Validation with DTOs

```typescript
import type { SignUpDTO } from '@/types';
import { z } from 'zod';

// Create Zod schema from DTO
const signUpSchema: z.ZodType<SignUpDTO> = z.object({
  email: z.string().email(),
  password: z.string().min(8),
  confirmPassword: z.string(),
  name: z.string().min(2)
}).refine(data => data.password === data.confirmPassword, {
  message: "Passwords don't match"
});
```

---

## üîó Relationship to Database Models

### Database Types Flow

```
PostgreSQL Database
      ‚Üì
Supabase CLI (gen types)
      ‚Üì
database.types.ts (Row, Insert, Update)
      ‚Üì
dto.ts (Pick/Omit/Extend from Row types)
      ‚Üì
Application code (Server Actions, Components)
```

### Example: Profile Type Flow

```typescript
// 1. Database (Supabase-generated)
type ProfileRow = Database['public']['Tables']['profiles']['Row'];

// 2. DTO (Derived)
interface UserProfileDTO extends Pick<ProfileRow, 'id' | 'email' | 'full_name'> {
  displayName: string; // Computed field
}

// 3. Application (Usage)
export async function getProfile(): Promise<ActionResult<UserProfileDTO>> {
  // Implementation
}
```

---

## ‚úÖ Best Practices

### DO ‚úÖ

1. **Always import from centralized index:**
   ```typescript
   import type { UserProfileDTO } from '@/types';
   ```

2. **Use ActionResult for Server Actions:**
   ```typescript
   Promise<ActionResult<T>>
   ```

3. **Derive DTOs from database types:**
   ```typescript
   interface MyDTO extends Pick<ProfileRow, 'id' | 'email'> {}
   ```

4. **Use type guards:**
   ```typescript
   if (isActionSuccess(result)) { /* ... */ }
   ```

5. **Document complex DTOs:**
   ```typescript
   /**
    * User subscription info DTO
    * Comprehensive subscription and usage information
    */
   export interface UserSubscriptionDTO { /* ... */ }
   ```

### DON'T ‚ùå

1. **‚ùå Don't edit database.types.ts manually**
   - Always regenerate from Supabase

2. **‚ùå Don't duplicate types**
   - Derive from database types using `Pick`, `Omit`, `Partial`

3. **‚ùå Don't import from database.types.ts directly**
   - Use the centralized index

4. **‚ùå Don't mix DTOs with Zod schemas**
   - Keep DTOs as TypeScript types
   - Create Zod schemas separately that match DTOs

5. **‚ùå Don't create overly complex nested DTOs**
   - Keep DTOs flat when possible
   - Use composition for complex structures

---

## üîÑ Maintaining DTOs

### When Database Schema Changes

1. **Regenerate database types:**
   ```bash
   npx supabase gen types typescript --project-id YOUR_PROJECT_ID > src/types/database.types.ts
   ```

2. **Check DTO compilation:**
   ```bash
   npx tsc --noEmit
   ```

3. **Update affected DTOs** if table structure changed

4. **Update Server Actions** using modified DTOs

5. **Update tests** with new type signatures

### Adding New DTOs

1. **Identify the database table** it relates to
2. **Derive from database types** using `Pick`, `Omit`, or `extends`
3. **Add to appropriate category** in `dto.ts`
4. **Export from `index.ts`**
5. **Document with JSDoc comments**
6. **Add usage example** to this README

---

## üìñ Type System Philosophy

This type system follows these principles:

1. **Single Source of Truth**: Database schema ‚Üí Generated types ‚Üí DTOs
2. **Type Safety**: No `any` types, strict TypeScript checks
3. **Maintainability**: Easy to update when schema changes
4. **Developer Experience**: Clear, consistent, well-documented
5. **Performance**: Minimal runtime overhead (types are compile-time only)

---

## üÜò Common Issues

### Issue: "Cannot find module '@/types'"

**Solution**: Check `tsconfig.json` paths:
```json
{
  "compilerOptions": {
    "paths": {
      "@/*": ["./src/*"]
    }
  }
}
```

### Issue: "Type error after database migration"

**Solution**: Regenerate database types:
```bash
npx supabase gen types typescript --project-id YOUR_PROJECT_ID > src/types/database.types.ts
```

### Issue: "DTO doesn't match actual data"

**Solution**: Check if you're using the correct database type:
- Use `Row` for SELECT queries
- Use `Insert` for INSERT operations
- Use `Update` for UPDATE operations

---

## üîç Quick Reference

| Operation | DTO Type | Usage |
|-----------|----------|-------|
| User login | `SignInDTO` | Form input |
| User registration | `SignUpDTO` | Form input |
| Display profile | `UserProfileDTO` | UI components |
| Create itinerary | `CreateItineraryDTO` | AI generation form |
| List itineraries | `ItineraryFilterDTO` | Filter/search UI |
| Check subscription | `UserSubscriptionDTO` | Pricing pages |
| Add to bucket list | `AddToBucketListDTO` | Save button |
| Generate AI plan | `GenerateItineraryDTO` | Main app flow |

---

## üìû Questions?

For type-related questions:
1. Check this README
2. Look at `dto.ts` JSDoc comments
3. Examine Server Action implementations
4. Review `database.types.ts` for source types

---

**Last Updated**: 2025-11-02
**Schema Version**: 1.1 (matches db-plan.md)

